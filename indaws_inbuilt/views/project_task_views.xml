<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
    <data>
        <record id="inherit_view_task_form2" model="ir.ui.view">
            <field name="name">inherit.view.task.form2</field>
            <field name="model">project.task</field>
            <field name="inherit_id" ref="project.view_task_form2"/>
            <field name="arch" type="xml">
                <xpath expr="//page[@name='description_page']" position="after">
                    <page name="materiales" string="Materiales">
                        <field name="material_ids" attrs="{'readonly': [('invoice_id', '!=', False)]}">
                            <tree editable="bottom">
                                <field name="analytic_move_id" invisible="1"/>
                                <field name="project_id" invisible="1"/>
                                <field name="task_id" invisible="1"/>
                                <field name="picking_id" attrs="{'readonly':[('analytic_move_id','!=',False)]}"/>
                                <field name="product_id" attrs="{'readonly':[('analytic_move_id','!=',False)]}"/>
                                <field name="comment" attrs="{'readonly':[('analytic_move_id','!=',False)]}"/>
                                <field name="quantity" attrs="{'readonly':[('analytic_move_id','!=',False)]}"/>
                                <field name="price_unit"/>
        		                <field name="total_price"/>
                                <field name="cost" attrs="{'readonly':[('analytic_move_id','!=',False)]}"/>
                                <field name="cost_subtotal" attrs="{'readonly':[('analytic_move_id','!=',False)]}"/>
                                <field name="picking_state" attrs="{'readonly':[('analytic_move_id','!=',False)]}"/>
                                <button icon="fa-truck" name="change_the_sent_value" string="" type="object" attrs="{'invisible':[('picking_id','!=',False)]}"/>
                            </tree>
                        </field>
                    </page>
                </xpath>

                <xpath expr="//page[@name='extra_info']" position="after">
                    <page name="resumen" string="Resumen">
                        <group>
                            <group string="Previsión" name="group_prevision">
                                <field name="forecast_costs_ids" >
                                    <tree>
                                        <field optional="show" name="name" string="Tipo"/>
                                        <field optional="show" name="quantity" string="Cantidad"/>
                                        <field optional="show" name="coste" string="Coste"/>
                                        <field name="currency_id" invisible="1"/>
                                    </tree>
                                </field>
                                <field name="cost_forecast"/>
                            </group>

                            <group string="Reales" name="group_reales">
                                <field name="real_costs_ids" >
                                    <tree>
                                        <field optional="show" name="name" string="Tipo"/>
                                        <field optional="show" name="quantity" string="Cantidad"/>
                                        <field optional="show" name="coste" string="Coste"/>
                                        <field name="currency_id" invisible="1"/>
                                    </tree>
                                </field>
                                <field name="cost_real"/>
                            </group>

                            <group string="Desviaciónes" name="group_desviacion">
                                <field name="cost_deviation"/>
                            </group>

                        </group>
                    </page>
                </xpath>

                <xpath expr="//field[@name='timesheet_ids']" position="attributes">
                    <attribute name="attrs">{'invisible':[('analytic_account_active', '=', False)], 'readonly': [('invoice_id', '!=', False)]}</attribute>
                </xpath>

                <xpath expr="//field[@name='timesheet_ids']/tree/field[@name='name']" position="before">
                    <field name="extra_hour_id"/>
                </xpath>

                <field name="project_id" position="after">
                    <field name="invoice_id" invisible="1"/>
                    <field name="show_fectura_btn" invisible="1"/>
                </field>

                <xpath expr="//div[@name='button_box']" position="inside">
                    <button name="action_open_task_invoice" type="object" class="oe_stat_button" icon="fa-pencil-square-o" string="Facturas" attrs="{'invisible': [('invoice_id', '=', False)]}"/>
<!--                    <button name="action_open_planning_slot" type="object" class="oe_stat_button" icon="fa-pencil-square-o" string="Recursos" attrs="{'invisible': [('invoice_id', '=', False)]}"/>-->
                    <button name="action_open_planning_slot"
                            type="object"
                            class="oe_stat_button"
                            icon="fa-calendar"
                            attrs="{'invisible': [('project_id', '=', False)]}">
                        <field name="planning_count" widget="statinfo" string="Recursos"/>
                    </button>
                </xpath>

                <xpath expr="//header" position="inside">
                    <button name="%(indaws_inbuilt.action_view_task_advance_payment_inv)d" string="Facturar" class="btn-primary" type="action" attrs="{'invisible':[('show_fectura_btn','=', False )]}" />
                </xpath>

                 <xpath expr="//form[1]/sheet[1]/notebook[1]/page[not(@name)][1]/group[1]/group[1]/div[1]" position="after">
                    <field name="planned_hours_task" class="o_field_float_time oe_inline ms-2" widget="timesheet_uom_no_toggle" />
                    <field name="hours_left"  class="o_field_float_time oe_inline ms-2" widget="timesheet_uom_no_toggle" />
                </xpath>

            </field>
        </record>


        <record id="indaws_inherit_view_task_tree2" model="ir.ui.view">
            <field name="name">indaws_inherit.view.task.tree2</field>
            <field name="model">project.task</field>
            <field name="inherit_id" ref="project.view_task_tree2" />
            <field name="arch" type="xml">
                <field name="stage_id" position="before">
                    <field name="invoice_status" widget="badge"/>
                </field>
            </field>
        </record>

        <record id="action_view_all_task_facturar" model="ir.actions.act_window">
            <field name="name">Tareas a facturar</field>
            <field name="res_model">project.task</field>
            <field name="view_mode">tree,kanban,form,calendar,pivot,graph,activity</field>
            <field name="context">{'search_default_my_tasks': 1, 'all_task': 0}</field>
            <field name="domain">[('project_id.is_billable','=', True), ('invoice_status', '=', 'to invoice')]}</field>
            <field name="search_view_id" ref="project.view_task_search_form_extended"/>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    No tasks found. Let's create one!
                </p><p>
                     To get things done, use activities and status on tasks.<br/>
                    Chat in real-time or by email to collaborate efficiently.
                </p>
            </field>
        </record>

        <menuitem
                name="My Tasks"
                id="menu_project_task_management"
                parent="project.menu_project_management"
                action="project.action_view_all_task"
                groups="base.group_no_one,project.group_project_user"
        />

        <menuitem
                name="Tareas a facturar"
                id="menu_project_task_fectura_management"
                parent="project.menu_project_management"
                action="action_view_all_task_facturar"
        />


    </data>
</odoo>